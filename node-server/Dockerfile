FROM node:alpine

WORKDIR /app

COPY node-server/package*.json .

RUN npm install

COPY node-server/ .

ARG FRONTEND_URL
ARG COGNITO_USER_POOL_ID
ARG COGNITO_CLIENT_ID
ARG POSTGRES_USER
ARG POSTGRES_PASSWORD
ARG POSTGRES_HOST
ARG POSTGRES_DB
ARG POSTGRES_PORT

RUN echo "FRONTEND_URL=$FRONTEND_URL" > .env
RUN echo "COGNITO_USER_POOL_ID=$COGNITO_USER_POOL_ID" >> .env
RUN echo "COGNITO_CLIENT_ID=$COGNITO_CLIENT_ID" >> .env
RUN echo "POSTGRES_USER=$POSTGRES_USER" >> .env
RUN echo "POSTGRES_PASSWORD=$POSTGRES_PASSWORD" >> .env
RUN echo "POSTGRES_HOST=$POSTGRES_HOST" >> .env
RUN echo "POSTGRES_DB=$POSTGRES_DB" >> .env
RUN echo "POSTGRES_PORT=$POSTGRES_PORT" >> .env

EXPOSE 3000

CMD ["node", "server.js"]
